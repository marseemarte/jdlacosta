<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Inscripción Secundaria</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/login.css">
</head>
<body class="d-flex align-items-center justify-content-center" style="min-height:100vh; background: var(--primary-blue, #f8f9fa);">
    <div class="login-container shadow-sm">
        <h2 class="mb-3 text-center">Iniciar Sesión</h2>
        <form id="loginForm" class="needs-validation" novalidate>
            <div class="form-group mb-3">
                <label for="username">Clave (clave):</label>
                <input type="text" id="username" name="username" class="form-control" required>
            </div>
            <div class="form-group mb-3">
                <label for="password">Contraseña (pass):</label>
                <input type="password" id="password" name="password" class="form-control" required>
            </div>
            <div id="errorMsg" class="error-message mb-2" role="alert" style="display:none;"></div>
            <button type="submit" class="btn btn-primary w-100">Ingresar</button>
        </form>
    </div>

<script>
document.getElementById('loginForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const clave = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value;
    const err = document.getElementById('errorMsg');
    err.style.display = 'none';

    if(!clave || !pass){
        err.textContent = 'Complete ambos campos.';
        err.style.display = 'block';
        return;
    }

    try {
        const fd = new FormData();
        fd.append('clave', clave);
        fd.append('pass', pass);
        const res = await fetch('api/login.php', { method:'POST', body: fd });
        const text = await res.text();

        // intentar parsear JSON; si falla mostrar texto bruto para depuración
        let json;
        try {
            json = JSON.parse(text);
        } catch (parseErr) {
            err.textContent = 'Respuesta no válida del servidor: ' + text;
            err.style.display = 'block';
            console.error('Respuesta no-JSON:', text);
            return;
        }

        if (res.ok && json.success) {
            window.location.href = 'dashboard.php';
        } else {
            err.textContent = json.message || 'Credenciales incorrectas.';
            err.style.display = 'block';
        }
    } catch (e) {
        err.textContent = 'Error de conexión al servidor. Ver consola/Network.';
        err.style.display = 'block';
        console.error(e);
    }
});
</script>
</body>
</html>